<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #181825; }
        #map { width: 100%; height: 100vh; }

        .leaflet-layer {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }

        .leaflet-popup-pane {
            filter: none !important; /* Protect popups from the invert filter */
        }

        .leaflet-popup-content-wrapper, .leaflet-popup-tip {
            background-color: #2e2e42 !important;
            color: white !important;
            box-shadow: 0 3px 14px rgba(0,0,0,0.9) !important;
            border: 2px solid #6a11cb !important;
            border-radius: 8px !important;
        }

        .leaflet-popup-content {
            font-size: 14px !important;
            font-weight: bold !important;
            margin: 15px !important;
            color: white !important;
        }

        .marker-pin {
            width: 30px;
            height: 30px;
            border-radius: 50% 50% 50% 0;
            background: #c30b82;
            position: absolute;
            transform: rotate(-45deg);
            left: 50%;
            top: 50%;
            margin: -15px 0 0 -15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.5);
        }
        .marker-pin::after {
            content: '';
            width: 14px;
            height: 14px;
            margin: 8px 0 0 8px;
            background: #fff;
            position: absolute;
            border-radius: 50%;
        }

        /* COLORS */
        .fire-pin { background: #ff4757; }
        .police-pin { background: #2ed573; }
        .medical-pin { background: #3742fa; }
        .accident-pin { background: #ffa502; }

        /* Pulsing Animation */
        .pulse { animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 71, 87, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    var map = L.map('map', {zoomAnimation: false}).setView([36.19, 44.00], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // --- CLICK LISTENER ---
    map.on('click', function(e) {
        // alert("DEBUG: Clicked at " + e.latlng);
        if (window.javaApp) {
            window.javaApp.onMapClick(e.latlng.lat, e.latlng.lng);
        } else {
            console.error("Bridge Missing!");
        }
    });

    // --- ADD MARKER FUNCTION ---
    function addMarker(lat, lon, title, type) {

        var cssClass = 'marker-pin';

        if (title.includes("Fire") || type.includes("Fire")) cssClass += ' fire-pin pulse';
        else if (title.includes("Medical") || type.includes("Medical")) cssClass += ' medical-pin';
        else if (title.includes("Accident") || type.includes("Accident")) cssClass += ' accident-pin';
        else if (title.includes("Police") || type.includes("Police")) cssClass += ' police-pin';

        var customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: "<div class='" + cssClass + "'></div>",
            iconSize: [30, 42],
            iconAnchor: [15, 42]
        });

        L.marker([lat, lon], {icon: customIcon}).addTo(map).bindPopup(title);
    }
</script>
</body>
</html>